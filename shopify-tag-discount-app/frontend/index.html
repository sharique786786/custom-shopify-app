<!-- In /frontend/index.html -->
<h2>Discount Rules (JSON)</h2>
<textarea id="jsonEditor" style="width: 100%; height: 200px;"></textarea>
<br/>
<button onclick="saveMetafields()">üíæ Save</button>

<script>
  async function saveMetafields() {
    const shop = new URLSearchParams(window.location.search).get('shop');
    const json = document.getElementById('jsonEditor').value;

    const res = await fetch(`/api/metafields`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        shop,
        namespace: 'custom',
        key: 'discount_rules',
        value: json,
        type: 'json',
      }),
    });

    if (res.ok) {
      alert('‚úÖ Saved successfully!');
    } else {
      alert('‚ùå Failed to save');
    }
  }

  async function loadMetafields() {
    const shop = new URLSearchParams(window.location.search).get('shop');
    const res = await fetch(`/api/metafields?shop=${shop}&namespace=custom&key=discount_rules`);
    const data = await res.json();

    document.getElementById('jsonEditor').value = JSON.stringify(data?.metafield?.value || {}, null, 2);
  }

  // Auto-load on page load
  window.onload = loadMetafields;
</script>
