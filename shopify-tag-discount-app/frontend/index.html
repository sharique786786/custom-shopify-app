<!DOCTYPE html>
<html>
<head>
  <title>Admin Interface</title>
</head>
<body>
  <h2>Admin Interface</h2>
  <button id="load">Load Metafields</button>
  <button id="save">Save Metafields</button>
  <br /><br />
  <textarea id="metafield-data" rows="20" cols="80" placeholder="Metafield JSON will appear here..."></textarea>

  <script>
    const shop = new URLSearchParams(window.location.search).get('shop');
    const metafieldTextarea = document.getElementById('metafield-data');

    document.getElementById('load').addEventListener('click', async () => {
      const res = await fetch(`/api/metafields?shop=${shop}`);
      const data = await res.json();
      metafieldTextarea.value = JSON.stringify(data.metafield || {}, null, 2);
    });

    document.getElementById('save').addEventListener('click', async () => {
      const json = metafieldTextarea.value;
      try {
        const parsed = JSON.parse(json);
        const res = await fetch(`/api/metafields?shop=${shop}`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ value: parsed })
        });

        const result = await res.json();
        alert(result.success ? '✅ Saved successfully' : '❌ Save failed');
      } catch (e) {
        alert('❌ Invalid JSON');
      }
    });
  </script>
</body>
</html>
